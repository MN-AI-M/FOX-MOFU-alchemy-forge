<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloxd Image Alchemy - Fox Mofu</title>

<style>
    body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: #000; font-family: 'Courier New', monospace; }
    
    /* 98% 領域: 変換画面 */
    #forge-section { width: 100%; height: 98vh; border: none; transition: height 0.5s ease; }
    iframe { width: 100%; height: 100%; border: none; }

    /* 2% 領域: 切り替え看板 (Switcher) */
    #mode-switcher {
        width: 100%; height: 2vh; background: #1a1a1a; color: #00ffff;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; font-size: 10px; letter-spacing: 2px;
        border-top: 1px solid #00ffff; box-shadow: 0 -5px 15px rgba(0,255,255,0.2);
        transition: background 0.3s;
    }
    #mode-switcher:hover { background: #333; color: #ff00ff; }

    /* 投稿・ギャラリー表示領域 (初期は非表示) */
    #gallery-section {
        display: none; width: 100%; height: 100vh; background: #0a0a0a;
        overflow-y: auto; padding: 20px; box-sizing: border-box; color: #eee;
    }

    /* ギャラリー内のカードデザイン */
    .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
    .post-card { background: #1a1a1a; border: 1px solid #444; border-radius: 8px; padding: 10px; text-align: center; }
    .post-card img { max-width: 100%; border-radius: 4px; }
    .post-card button { margin-top: 10px; background: #00ffff; border: none; padding: 5px 10px; cursor: pointer; }

    /* ロード画面 */
    #loading-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 1s; }
    .loading-text { color: #555; letter-spacing: 2px; }

    #seo-content { position: absolute; left: -9999px; }
</style>
</head>
<body>

<div id="seo-content">
    <h1>Bloxd Image Alchemy - Fox Mofu</h1>
    <p>340種類のブロックで一瞬でドット絵へ変換。最高峰のBloxd.io用ツール。</p>
</div>

<div id="forge-section">
    <iframe id="forge-iframe" src="https://foxmofuyt-fox-mofu-bloxd-image-alchemy.hf.space" 
    allow="clipboard-read; clipboard-write; downloads"
    sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>
</div>

<div id="mode-switcher" onclick="toggleMode()">
    <span id="switcher-text">▲ SWITCH TO GALLERY (投稿画面へ) ▲</span>
</div>

<div id="gallery-section">
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #00ffff; margin-bottom: 20px; padding-bottom: 10px;">
        <h2 style="color: #00ffff; margin: 0;">COMMUNITY GALLERY</h2>
        <button onclick="toggleMode()" style="background:transparent; color:#ff00ff; border:1px solid #ff00ff; padding:5px 15px; cursor:pointer;">BACK TO FORGE</button>
    </div>
    <div id="gallery-container" class="gallery-grid">
        <p>Loading gallery items...</p>
    </div>
</div>

<div id="loading-overlay"><div class="loading-text">CORE FORGE LOADING...</div></div>

<script>
let currentMode = "forge";

function toggleMode() {
    const forge = document.getElementById('forge-section');
    const gallery = document.getElementById('gallery-section');
    const switcher = document.getElementById('mode-switcher');
    const text = document.getElementById('switcher-text');

    if (currentMode === "forge") {
        forge.style.display = "none";
        gallery.style.display = "block";
        switcher.style.height = "5vh"; // ギャラリー時は少し太くして戻りやすく
        text.innerText = "▼ BACK TO FORGE (変換に戻る) ▼";
        currentMode = "gallery";
        loadGallery(); // モード切替時に読み込み
    } else {
        forge.style.display = "block";
        gallery.style.display = "none";
        switcher.style.height = "2vh";
        text.innerText = "▲ SWITCH TO GALLERY (投稿画面へ) ▲";
        currentMode = "forge";
    }
}

// ギャラリー読み込み (Hugging Face Datasetから直接)
async function loadGallery() {
    const url = "https://huggingface.co/datasets/YourID/Forge-Data/raw/main/metadata.jsonl";
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Fetch failed");
        const text = await response.text();
        const posts = text.split('\n').filter(line => line).map(JSON.parse);
        
        const galleryEl = document.getElementById('gallery-container');
        galleryEl.innerHTML = posts.reverse().map(post => `
            <div class="post-card">
                <img src="${post.preview_url}" alt="Preview">
                <p style="font-size:12px; color:#888;">Size: ${post.size}</p>
                <button onclick="window.open('${post.zip_url}')">DOWNLOAD ZIP</button>
            </div>
        `).join('');
    } catch (e) {
        document.getElementById('gallery-container').innerHTML = "<p>ギャラリーを読み込めませんでした。データがまだないか、公開設定を確認してください。</p>";
    }
}

// パスワードハッシュ化 (投稿時に使用)
async function hashPassword(password) {
    const msgUint8 = new TextEncoder().encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
}

// ロード画面フェード
window.addEventListener("load", function () {
    setTimeout(() => {
        const overlay = document.getElementById("loading-overlay");
        overlay.style.opacity = "0";
        setTimeout(() => overlay.style.display = "none", 1000);
    }, 2000);
});
</script>
</body>
</html>
